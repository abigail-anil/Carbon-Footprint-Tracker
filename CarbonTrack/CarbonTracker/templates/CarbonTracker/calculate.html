{% extends "CarbonTracker/base_generic.html" %}

{% block content %}
<div style="display: flex;">
    <div style="width: 200px; background-color: #e0e0e0; padding: 10px; height: 100vh; font-size: 1.2em;">
        <a href="{% url 'calculate_emission' %}" style="font-size: 1.2em;">Calculate Emission</a><br><br>
        <a href="{% url 'emission_reports' %}" style="font-size: 1.2em;">Emission Reports</a>
    </div>
    <div style="padding: 20px; flex-grow: 1; font-size: 1.2em;">
        <h1 style="text-align: center; font-size: 1.5em;">Carbon Footprint Tracker</h1>

        <form method="post" style="margin-top: 20px;">
            {% csrf_token %}
            <div style="text-align: center;">
                {{ activity_form.as_p }}
            </div>

            <div style="margin-top: 10px; text-align: center;">
                {% if activity_type == 'electricity' %}
                    {{ form.as_p }}
                {% elif activity_type == 'flight' %}
                    <p>
                        {{ form.departure_airport.label_tag }}
                        {{ form.departure_airport }}
                        <a href="https://www.iata.org/en/publications/directories/code-search/" target="_blank">Search Airport Code</a>
                    </p>
                    <p>
                        {{ form.destination_airport.label_tag }}
                        {{ form.destination_airport }}
                        <a href="https://www.iata.org/en/publications/directories/code-search/" target="_blank">Search Airport Code</a>
                    </p>
                    <p>
                        {{ form.passengers.label_tag }}
                        {{ form.passengers }}
                    </p>
                {% elif activity_type == 'shipping' %}
                    {{ form.as_p }}
                {% endif %}
            </div>

            <div style="margin-top: 20px; text-align: center;">
                <button type="submit" style="background-color: #4CAF50; color: white; padding: 10px 20px; border: none; cursor: pointer; font-size: 1.2em;">Calculate</button>
            </div>

            <div id="emission-result" style="margin-top: 20px; text-align: center;">
                {% if form.errors %}
                    <div style="color: red;">
                        {{ form.errors }}
                    </div>
                {% endif %}
                {% if error %}
                    <p style="color: red;">{{ error }}</p>
                {% endif %}
                {% if result %}
                    <p>{{ result }}</p>
                    <a href="{% url 'emission_reports' %}">View Emission Report</a>
                {% endif %}
            </div>
        </form>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const activitySelect = document.getElementById('id_activity_type');
                if (activitySelect) {
                    activitySelect.addEventListener('change', () => {
                        const selectedActivity = activitySelect.value;
                        const url = new URL(window.location.href);
                        url.searchParams.set('activity_type', selectedActivity);
                        window.location.href = url.href;
                    });
                }
            });
        </script>
    </div>
</div>
{% endblock content %}